<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- ğŸ”¹ Allow pinch-zoom: user-scalable=yes & higher maximum-scale -->
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">

  <!-- ğŸ”¥ Google Analytics 4 (GA4) Tracking Code -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSLLZEP6QN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    // ğŸ”¹ PDF íŒŒì¼ëª…ì— ë”°ë¼ GA4ìš© í˜ì´ì§€ ì œëª©ì„ ë‹¤ë¥´ê²Œ ì„¤ì •
    (function () {
      try {
        const params = new URLSearchParams(window.location.search);
        const file = params.get("file") || "";
        let title = "PDF Viewer";

        // íŒŒì¼ ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ë¶„ê¸° (í•„ìš”í•˜ë©´ ììœ ë¡­ê²Œ ì¶”ê°€ ê°€ëŠ¥)
        if (file.includes("US-Biztrip-Guideline-KO")) {
          title = "US Biztrip Compliance Guideline â€“ KO â€“ PDF Viewer";
        } else if (file.includes("US-Biztrip-Guideline-EN")) {
          title = "US Biztrip Compliance Guideline â€“ EN â€“ PDF Viewer";
        } else if (file.includes("US-Biztrip-Checklist-KO")) {
          title = "US Biztrip Checklist â€“ KO â€“ PDF Viewer";
        } else if (file.includes("US-Biztrip-Checklist-EN")) {
          title = "US Biztrip Checklist â€“ EN â€“ PDF Viewer";
        } else if (file.includes("US-Biztrip-Summary-KO")) {
          title = "US Biztrip Summary â€“ KO â€“ PDF Viewer";
        } else if (file.includes("US-Biztrip-Summary-EN")) {
          title = "US Biztrip Summary â€“ EN â€“ PDF Viewer";
        }

        // ì‹¤ì œ ë¸Œë¼ìš°ì € íƒ­ ì œëª© ë³€ê²½ â†’ GA4 page_titleë„ ì´ ê°’ìœ¼ë¡œ ì°í˜
        document.title = title;
      } catch (e) {
        console.error(e);
      }
    })();

    gtag('js', new Date());
    gtag('config', 'G-YSLLZEP6QN');
  </script>
  <!-- ğŸ”¥ GA4 ì½”ë“œ ë -->

  <title>PDF Viewer</title>
  <link rel="stylesheet" href="viewer.css">

  <!-- ğŸ”¹ HOME button & pinch-zoom related styles -->
  <style>
    .toolbar .nav-link,
    .toolbar .home-link {
      margin-right: 8px;
      padding: 4px 10px;
      border-radius: 4px;
      background: #2563eb;
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      display: inline-block;
      border: 0;
      cursor: pointer;
    }

    /* ğŸ”¹ Back button (same style, but slightly darker is okay; keep identical if you want) */
    .toolbar .nav-link {
      background: #1d4ed8;
    }

    /* ğŸ”¹ Allow pinch-zoom on the canvas area */
    #viewer-wrap,
    #pdf-render {
      touch-action: pinch-zoom;
    }

    /* ğŸ”¹ (Optional) Hide zoom UI on mobile devices */
    @media (pointer: coarse) {
      #zoom-out,
      #zoom-in,
      #fit-width,
      #zoom {
        display: none;
      }
    }
  </style>

  <!-- PDF.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
  </script>
</head>

<body>
  <div class="toolbar">
    <!-- âœ… NEW: One-level up (Back) -->
    <button type="button" class="nav-link" id="back-btn">â† ì´ì „</button>

    <!-- ğŸ”¹ Link back to HOME (always root) -->
    <a href="../index.html" class="home-link">â† HOME</a>

    <button id="prev">â—€</button>
    <span>
      Page <input id="page-num" type="number" min="1" value="1">
      / <span id="page-count">1</span>
    </span>
    <button id="next">â–¶</button>

    <span class="spacer"></span>

    <button id="zoom-out">ï¼</button>
    <span id="zoom">100%</span>
    <button id="zoom-in">ï¼‹</button>
    <button id="fit-width">Fit to Width</button>
  </div>

  <div id="viewer-wrap">
    <canvas id="pdf-render"></canvas>
  </div>

  <script>
    // âœ… Back navigation logic:
    // 1) If URL has ?back=...  â†’ go there (most stable)
    // 2) Else if history exists â†’ history.back()
    // 3) Else fallback â†’ HOME
    (function () {
      const btn = document.getElementById("back-btn");
      if (!btn) return;

      btn.addEventListener("click", () => {
        try {
          const params = new URLSearchParams(window.location.search);
          const back = params.get("back");

          if (back) {
            // Allow relative paths like "purchase.html" or "../purchase/index.html"
            window.location.href = back;
            return;
          }

          // If user came from a previous page in-app, go back
          if (window.history.length > 1) {
            window.history.back();
            return;
          }

          // Fallback
          window.location.href = "../index.html";
        } catch (e) {
          window.location.href = "../index.html";
        }
      });
    })();
  </script>

  <script src="app.js"></script>
</body>
</html>
